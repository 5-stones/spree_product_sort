<ul class="products_ul" id='products'>
  <%
    if taxon.id
      products = taxon.products.available.active.includes(:translations, master: :images)
    else
      products = Spree::Product.available.includes(:images)
    end

    #collect the pts for this taxon from each product
    product_taxons = products.collect {|p| p.product_taxons.where(:taxon_id => taxon.id || 0).first }
  %>

  <% product_taxons.compact.each do |pt| %>
    <li id="product_taxons_<%=pt.id%>" class="product-listing text-center">
      <span class="handle"><i class="glyphicon glyphicon-move"> </i></span>
      <%= image_tag pt.product.list_image %><br>
      <%= h pt.product.name %>

    </li>
  <% end %>
</ul>
